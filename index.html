<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š UtilitÄƒÈ›ile Mele PWA v4.1</title>
    
    <!-- PWA CONFIGURATION -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="UtilitÄƒÈ›i PWA">
    
    <!-- SEO & DESCRIPTION -->
    <meta name="description" content="AplicaÈ›ie PWA pentru gestionarea utilitaÈ›ilor È™i tracking auto complet. Sincronizare familie, export Excel, reminder-uri automate.">
    <meta name="keywords" content="utilitÄƒÈ›i, PWA, contoare, tracking auto, sincronizare familie">
    
    <!-- ICONS FOR PWA -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- EXTERNAL CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- EXTERNAL SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>ğŸ“Š UtilitÄƒÈ›ile Mele PWA v4.1</h1>
            <div class="pwa-indicator">
                ğŸš— Car Tracking Enhanced â€¢ ğŸ“Š Export funcÈ›ional â€¢ ğŸ”„ Sync bidirectional
            </div>
            <p>ğŸš— Tracking complet auto (nr. Ã®nmatriculare, ITP, RCA) â€¢ ğŸ“Š Rapoarte funcÈ›ionale â€¢ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Sincronizare familie</p>
        </div>

        <!-- STATUS BAR -->
        <div class="status-bar">
            <div class="family-code">
                ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familie: <span id="familyCode">-</span>
                <button class="btn btn-info" onclick="setupFamily()">âš™ï¸ ConfigureazÄƒ</button>
            </div>
            <div class="sync-status disconnected" id="syncStatus">
                ğŸ”´ Offline
            </div>
        </div>

        <!-- ALERTS CONTAINER -->
        <div id="alerts"></div>

        <!-- NAVIGATION TABS -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('home')">ğŸ  AcasÄƒ</button>
            <button class="tab" onclick="showTab('meters')">ğŸ“Š Contoare</button>
            <button class="tab" onclick="showTab('car')">ğŸš— MaÈ™ina</button>
            <button class="tab" onclick="showTab('reports')">ğŸ“ˆ Rapoarte</button>
            <button class="tab" onclick="showTab('settings')">âš™ï¸ SetÄƒri</button>
        </div>

        <!-- HOME TAB -->
        <div class="section active" id="home">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>ğŸ“Š Indexuri citite luna aceasta</h4>
                    <div class="value" id="indexesThisMonth">0/4</div>
                </div>
                <div class="stat-card">
                    <h4>âš ï¸ Reminder-uri active</h4>
                    <div class="value" id="activeReminders">0</div>
                </div>
                <div class="stat-card">
                    <h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Utilizatori conectaÈ›i</h4>
                    <div class="value" id="connectedUsers">1</div>
                </div>
                <div class="stat-card">
                    <h4>ğŸ’° Estimare cost lunar</h4>
                    <div class="value" id="estimatedCost">- RON</div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ”” Reminder-uri Active</h3>
                <div id="remindersList">
                    <p style="text-align: center; color: #666; padding: 20px;">Se Ã®ncarcÄƒ...</p>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-success" onclick="markAllRead()">âœ… MarcheazÄƒ toate ca citite</button>
                <button class="btn btn-primary" onclick="showQuickIndex()">âš¡ Index rapid</button>
                <button class="btn btn-warning" onclick="generateQuickReport()">ğŸ“‹ Raport rapid</button>
                <button class="btn btn-info" onclick="syncNow()">ğŸ”„ SincronizeazÄƒ acum</button>
            </div>
        </div>

        <!-- METERS TAB -->
        <div class="section" id="meters">
            <div class="card">
                <h3>ğŸ’§ Contoare ApÄƒ</h3>
                <div class="index-grid">
                    <div class="index-info">
                        <h4>Apometru Baie</h4>
                        <div class="index-last" id="waterBathLast">Ultimul: -</div>
                    </div>
                    <div class="index-current" id="waterBathCurrent">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="addReading('waterBath')">ğŸ“ CiteÈ™te</button>
                        <button class="btn btn-danger" onclick="deleteReading('waterBath')">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="index-grid">
                    <div class="index-info">
                        <h4>Apometru BucÄƒtÄƒrie</h4>
                        <div class="index-last" id="waterKitchenLast">Ultimul: -</div>
                    </div>
                    <div class="index-current" id="waterKitchenCurrent">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="addReading('waterKitchen')">ğŸ“ CiteÈ™te</button>
                        <button class="btn btn-danger" onclick="deleteReading('waterKitchen')">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ”¥ Gaz & Electricitate</h3>
                <div class="index-grid">
                    <div class="index-info">
                        <h4>Contor Gaz</h4>
                        <div class="index-last" id="gasLast">Ultimul: -</div>
                    </div>
                    <div class="index-current" id="gasCurrent">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="addReading('gas')">ğŸ“ CiteÈ™te</button>
                        <button class="btn btn-danger" onclick="deleteReading('gas')">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="index-grid">
                    <div class="index-info">
                        <h4>Contor Electricitate</h4>
                        <div class="index-last" id="electricLast">Ultimul: -</div>
                    </div>
                    <div class="index-current" id="electricCurrent">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="addReading('electric')">ğŸ“ CiteÈ™te</button>
                        <button class="btn btn-danger" onclick="deleteReading('electric')">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CAR TAB -->
        <div class="section" id="car">
            <div class="card">
                <h3>ğŸš— InformaÈ›ii Auto - Tracking Complet</h3>
                
                <!-- NumÄƒrul de Ã®nmatriculare -->
                <div class="car-info-grid">
                    <div>
                        <h4>ğŸ”¢ NumÄƒrul de Ã®nmatriculare</h4>
                        <div class="car-detail">PlÄƒcuÈ›ele auto oficiale</div>
                        <div class="car-value" id="carNumberDisplay">Nu a fost adÄƒugat</div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateCarNumber()">ğŸ“ AdaugÄƒ/EditeazÄƒ</button>
                    </div>
                </div>

                <!-- Marca È™i modelul -->
                <div class="car-info-grid">
                    <div>
                        <h4>ğŸ­ Marca È™i Modelul</h4>
                        <div class="car-detail">Ex: Dacia Logan, BMW X3, etc.</div>
                        <div class="car-value" id="carBrandDisplay">Nu a fost adÄƒugat</div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateCarBrand()">ğŸ“ AdaugÄƒ/EditeazÄƒ</button>
                    </div>
                </div>

                <!-- Anul fabricaÈ›iei -->
                <div class="car-info-grid">
                    <div>
                        <h4>ğŸ“… Anul fabricaÈ›iei</h4>
                        <div class="car-detail">Anul Ã®n care a fost produsÄƒ maÈ™ina</div>
                        <div class="car-value" id="carYearDisplay">Nu a fost adÄƒugat</div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateCarYear()">ğŸ“ AdaugÄƒ/EditeazÄƒ</button>
                    </div>
                </div>

                <!-- Kilometrajul -->
                <div class="car-info-grid">
                    <div>
                        <h4>ğŸ›£ï¸ Kilometrajul actual</h4>
                        <div class="car-detail">Ultima actualizare: <span id="kmLastUpdate">-</span></div>
                        <div class="car-value" id="carKmDisplay">Nu a fost adÄƒugat</div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateCarKm()">ğŸ“ ActualizeazÄƒ</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ”§ ÃntreÈ›inere MaÈ™inÄƒ</h3>
                <div class="index-grid">
                    <div class="index-info">
                        <h4>Schimb Ulei</h4>
                        <div class="index-last" id="oilChangeLast">Ultima datÄƒ: -</div>
                        <small style="color: #666;">Recomandat la 6 luni sau 10.000 km</small>
                    </div>
                    <div class="index-current" id="oilChangeNext">--- zile</div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="updateOilChange()">ğŸ”§ Am schimbat</button>
                        <button class="btn btn-primary" onclick="editOilChange()">âœï¸ EditeazÄƒ</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“„ Documente Auto</h3>
                
                <!-- ITP -->
                <div class="index-grid">
                    <div class="index-info">
                        <h4>ğŸ” ITP (InspecÈ›ie TehnicÄƒ)</h4>
                        <div class="index-last" id="itpLast">Expirare: -</div>
                        <small style="color: #666;">Obligatoriu anual pentru maÈ™ini > 12 ani</small>
                    </div>
                    <div class="index-current" id="itpStatus">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateITP()">ğŸ“„ ActualizeazÄƒ</button>
                        <a href="https://itp.ro/programare" target="_blank" class="btn btn-info">ğŸŒ ProgrameazÄƒ ITP</a>
                    </div>
                </div>
                
                <!-- ROVINIETÄ‚ -->
                <div class="index-grid">
                    <div class="index-info">
                        <h4>ğŸ›£ï¸ RovinietÄƒ</h4>
                        <div class="index-last" id="rovignetteLast">Expirare: -</div>
                        <small style="color: #666;">Obligatorie pentru drumuri naÈ›ionale È™i autostrÄƒzi</small>
                    </div>
                    <div class="index-current" id="rovignetteStatus">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateRovignette()">ğŸ“„ ActualizeazÄƒ</button>
                        <a href="https://roviniete.ro/" target="_blank" class="btn btn-success">ğŸ›’ Roviniete.ro</a>
                    </div>
                </div>

                <!-- ASIGURARE RCA -->
                <div class="index-grid">
                    <div class="index-info">
                        <h4>ğŸ›¡ï¸ Asigurare RCA</h4>
                        <div class="index-last" id="insuranceLast">Expirare: -</div>
                        <small style="color: #666;">Obligatoriu È™i verificat de poliÈ›ie</small>
                    </div>
                    <div class="index-current" id="insuranceStatus">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateInsurance()">ğŸ“„ ActualizeazÄƒ</button>
                        <a href="https://pago.ro/" target="_blank" class="btn btn-success">ğŸ’³ Pago.ro</a>
                    </div>
                </div>

                <!-- ASIGURARE CASCO -->
                <div class="index-grid">
                    <div class="index-info">
                        <h4>ğŸ›¡ï¸ Asigurare CASCO</h4>
                        <div class="index-last" id="cascoLast">Expirare: -</div>
                        <small style="color: #666;">OpÈ›ionalÄƒ - protecÈ›ie completÄƒ</small>
                    </div>
                    <div class="index-current" id="cascoStatus">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateCasco()">ğŸ“„ ActualizeazÄƒ</button>
                        <a href="https://pago.ro/casco" target="_blank" class="btn btn-success">ğŸ’³ Pago CASCO</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- REPORTS TAB -->
        <div class="section" id="reports">
            <div class="card">
                <h3>ğŸ“Š Raport Complet</h3>
                
                <!-- Raport Auto -->
                <div style="background: rgba(33, 150, 243, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h4 style="color: #1976D2; margin-bottom: 15px;">ğŸš— InformaÈ›ii Auto</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <strong>NumÄƒrul de Ã®nmatriculare:</strong><br>
                            <span id="reportCarNumber">Nu a fost adÄƒugat</span>
                        </div>
                        <div>
                            <strong>Marca È™i modelul:</strong><br>
                            <span id="reportCarBrand">Nu a fost adÄƒugat</span>
                        </div>
                        <div>
                            <strong>Anul fabricaÈ›iei:</strong><br>
                            <span id="reportCarYear">Nu a fost adÄƒugat</span>
                        </div>
                        <div>
                            <strong>Kilometrajul:</strong><br>
                            <span id="reportCarKm">Nu a fost adÄƒugat</span>
                        </div>
                    </div>
                    
                    <h5 style="color: #1976D2; margin: 15px 0 10px 0;">ğŸ“„ Status Documente:</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        <div>ITP: <span id="reportITP">-</span></div>
                        <div>RCA: <span id="reportInsurance">-</span></div>
                        <div>RovinietÄƒ: <span id="reportRovignette">-</span></div>
                        <div>CASCO: <span id="reportCasco">-</span></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“ˆ Grafic Consumuri</h3>
                <div class="chart-container">
                    <canvas id="consumptionChart" width="400" height="200"></canvas>
                    <div id="chartPlaceholder" style="text-align: center; padding: 50px; color: #666;">
                        ğŸ“Š Graficul va fi afiÈ™at aici cÃ¢nd sunt suficiente date
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“Š Tabel Consumuri</h3>
                <div style="overflow-x: auto;">
                    <table class="consumption-table" id="consumptionTable">
                        <thead>
                            <tr>
                                <th>Luna</th>
                                <th>ApÄƒ Baie (mc)</th>
                                <th>ApÄƒ BucÄƒtÄƒrie (mc)</th>
                                <th>Gaz (mc)</th>
                                <th>Electricitate (kWh)</th>
                                <th>Cost Total (RON)</th>
                            </tr>
                        </thead>
                        <tbody id="consumptionTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 20px; color: #666;">
                                    Se Ã®ncarcÄƒ datele...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“‹ Export pentru AsociaÈ›ia de Proprietari</h3>
                <div style="background: rgba(76, 175, 80, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h4 style="color: #2E7D32; margin-bottom: 15px;">ğŸ“‹ FiÈ™ier Excel profesional pentru asociaÈ›ia de proprietari</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <strong>ğŸ“ Include:</strong><br>
                            â€¢ Indexuri actuali la toate contoarele<br>
                            â€¢ Consumurile calculate automat<br>
                            â€¢ Costurile estimate
                        </div>
                        <div>
                            <strong>ğŸ‘¤ Date personale:</strong><br>
                            â€¢ Nume: Iordache Florin<br>
                            â€¢ Adresa: Str. Dunarii, Bl K1, Sc. A, Ap. 9<br>
                            â€¢ Data raportului
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-success" onclick="exportExcelEnhanced()" style="font-size: 1.1rem; padding: 15px 30px;">
                            ğŸ“‹ GenereazÄƒ Excel pentru AsociaÈ›ie
                        </button>
                    </div>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-danger" onclick="exportPDF()">ğŸ“„ Export PDF</button>
                <button class="btn btn-info" onclick="shareReport()">ğŸ“¤ PartajeazÄƒ JSON</button>
                <button class="btn btn-warning" onclick="generateDetailedReport()">ğŸ“Š Raport detaliat</button>
                <button class="btn" onclick="debugReport()" style="background: #9C27B0;">ğŸ› Debug Raport</button>
            </div>
        </div>

        <!-- SETTINGS TAB -->
        <div class="section" id="settings">
            <div class="card">
                <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ SetÄƒri Familie</h3>
                <div class="form-group">
                    <label>Cod Familie:</label>
                    <input type="text" id="familyCodeInput" placeholder="IntroduceÈ›i codul familiei">
                    <small style="color: #666;">PartajaÈ›i acest cod cu membrii familiei pentru sincronizare</small>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveFamily()">ğŸ’¾ SalveazÄƒ</button>
                    <button class="btn btn-warning" onclick="generateFamilyCode()">ğŸ”„ GenereazÄƒ cod nou</button>
                    <button class="btn btn-info" onclick="testSync()">ğŸ§ª Test sincronizare</button>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 8px;">
                    <h5>ğŸ“¡ Status Sincronizare:</h5>
                    <p id="syncDetails">Offline - configuraÈ›i codul familiei pentru sincronizare</p>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ’° PreÈ›uri UtilitÄƒÈ›i</h3>
                <div class="form-group">
                    <label>PreÈ› apÄƒ (RON/mc):</label>
                    <input type="number" id="waterPrice" value="15.50" step="0.01">
                </div>
                <div class="form-group">
                    <label>PreÈ› gaz (RON/mc):</label>
                    <input type="number" id="gasPrice" value="3.20" step="0.01">
                </div>
                <div class="form-group">
                    <label>PreÈ› electricitate (RON/kWh):</label>
                    <input type="number" id="electricPrice" value="0.65" step="0.01">
                </div>
                <button class="btn btn-primary" onclick="savePrices()">ğŸ’¾ SalveazÄƒ preÈ›urile</button>
            </div>

            <div class="card">
                <h3>âš ï¸ Zona de Pericol</h3>
                <div class="btn-group">
                    <button class="btn btn-warning" onclick="resetReadings()">ğŸ”„ ReseteazÄƒ doar citirile</button>
                    <button class="btn btn-danger" onclick="factoryReset()">ğŸ­ Factory Reset complet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FORM OVERLAY -->
    <div class="form-overlay" id="formOverlay">
        <div class="form-popup">
            <h3 id="formTitle">AdaugÄƒ Citire</h3>
            <div class="form-group">
                <label id="formLabel">Valoare:</label>
                <input type="number" id="formValue" placeholder="IntroduceÈ›i valoarea">
            </div>
            <div class="form-group">
                <label>Data:</label>
                <input type="date" id="formDate">
            </div>
            <div class="btn-group">
                <button class="btn btn-success" onclick="saveReading()">ğŸ’¾ SalveazÄƒ</button>
                <button class="btn" onclick="closeForm()" style="background: #666;">âŒ AnuleazÄƒ</button>
            </div>
        </div>
    </div>

    <!-- MAIN JAVASCRIPT -->
    <script src="script.js"></script>
    
    <!-- PWA SERVICE WORKER REGISTRATION -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('âœ… SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('âŒ SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
