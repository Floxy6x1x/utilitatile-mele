<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š UtilitÄƒÈ›ile Mele PWA</title>
    
    <!-- PWA MANIFEST -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVXRpbGl0xINFo2lsZSBNZWxlIFBXQSIsInNob3J0X25hbWUiOiJVdGlsaXTEg8WjaSDwn5ONPYJ8IiwiZGVzY3JpcHRpb24iOiJBcGxpY2HFo2llIFBXQSBwZW50cnUgbWFuYWdlbWVudHVsIHV0aWxpdMSDdGlsb3IiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzY2N2VlYSIsInRoZW1lX2NvbG9yIjoiIzRDQUY1MCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUJwWkQwaVNXTnZiaUlnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUIzYVdSMGFEMGlNVEk0SWlCb1pXbG5hSFE5SWpFeU9DSWdkbWxsZDBKdmVEMGlNQ0F3SURFME5DQXhORFFpUGp4d1lYUm9JR1pwYkd3aUl6UTBOek0zTkdJaUlHUTlJakVnT1M0ek5TMHlMalUyTGpBNU5DMHpMamsyZGpWc05TNTJNelUyYUVjNGRqUjBiRGhvTWpsY05YWmtPV0ZzTFRkdU1qZDBOMkZvTjJFdE1pNDFjbE11TVRJM2VpSThaeTgvUGk4dmMzWm5QZz09IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJzaXplcyI6IjE5MngxOTIifSx7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QnBaRDBpU1dOdmJpSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklpQjNhV1IwYUQwaU5URXlJaUJvWldsbmFIUTlJalV4TWlJZ2RtbGxkMEp2ZUQwaU1DQXdJRGcwTkNBNE5EUWlQanhIWVhSb0lHWnBiR3c5SW1ObGNsTm9jQ2dnWVdaeGJrNWhUb0VYWmlJZ1pEMGlOVzVmZVhWVE52Y0hKNE9HTnlkMDIySklKb0E1TXpOSldHOEpNWTdnVzRJNWJKWE0zT2ozY3pob1FSWG5BYS0tMDFvOHMxekJzYzBReDlaRk41T1cxNE9HUnpkMk5ORHhJTWkxTmRqUmtialV5UlNnaVBqeG5QaThySWk4dmMzWm5QZz09IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJzaXplcyI6IjUxMng1MTIifV19">
    
    <!-- PWA META TAGS -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="UtilitÄƒÈ›i PWA">
    
    <!-- SERVICE WORKER REGISTRATION -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('data:text/javascript;base64,Y29uc3QgQ0FDSEVfTkFNRSA9ICd1dGlsaXRhdGktcHdhLXYxJzsKY29uc3QgdXJsc1RvQ2FjaGUgPSBbCiAgJy8nLAogICcvaW5kZXguaHRtbCcKXTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignaW5zdGFsbCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgZXZlbnQud2FpdFVudGlsKAogICAgY2FjaGVzLm9wZW4oQ0FDSEVfTkFNRSkudGhlbihmdW5jdGlvbihjYWNoZSkgewogICAgICByZXR1cm4gY2FjaGUuYWRkQWxsKHVybHNUb0NhY2hlKTsKICAgIH0pCiAgKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZnVuY3Rpb24oZXZlbnQpIHsKICBldmVudC5yZXNwb25kV2l0aCgKICAgIGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KQogICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmV0Y2goZXZlbnQucmVxdWVzdCk7CiAgICAgIH0pCiAgKTsKfSk7')
                .then(registration => {
                    console.log('âœ… PWA Service Worker Ã®nregistrat!', registration);
                })
                .catch(registrationError => {
                    console.log('âŒ PWA Service Worker eÈ™uat:', registrationError);
                });
            });
        }
    </script>
    
    <!-- EXTERNAL LIBRARIES pentru export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --dark: #343a40;
            --light: #f8f9fa;
            --radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .pwa-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(45deg, #4CAF50, #2196F3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 10px 0;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .family-code {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .sync-status.connected { background: #d4edda; color: #155724; }
        .sync-status.disconnected { background: #f8d7da; color: #721c24; }
        .sync-status.syncing { 
            background: #fff3cd; 
            color: #856404; 
            animation: pulse 1.5s infinite;
        }

        .tabs {
            display: flex;
            background: rgba(255,255,255,0.9);
            border-radius: var(--radius);
            padding: 8px;
            margin-bottom: 25px;
            gap: 8px;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            color: #666;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .card {
            background: rgba(255,255,255,0.95);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .card h3 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .meter-grid {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: center;
            padding: 20px;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .meter-info h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }

        .meter-last {
            font-size: 0.9rem;
            color: #666;
        }

        .meter-current {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            min-width: 100px;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
            background: var(--secondary);
            color: white;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-primary { background: var(--primary); }
        .btn-success { background: var(--success); }
        .btn-warning { background: var(--warning); }
        .btn-danger { background: var(--danger); }
        .btn-info { background: var(--info); }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 25px;
            justify-content: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: var(--radius);
            text-align: center;
        }

        .stat-card h4 {
            font-size: 1rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin: 20px 0;
        }

        .form-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: none;
            backdrop-filter: blur(5px);
        }

        .form-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .reminder-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .reminder-item.overdue {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid var(--danger);
        }

        .reminder-item.due-soon {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid var(--warning);
        }

        .reminder-item.urgent {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid var(--danger);
            animation: pulse 2s infinite;
        }

        .alert {
            padding: 15px 20px;
            border-radius: var(--radius);
            margin-bottom: 15px;
            font-weight: 500;
            animation: slideInDown 0.5s ease;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--danger);
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid var(--success);
        }

        .consumption-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .consumption-table th,
        .consumption-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .consumption-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .consumption-table tbody tr:hover {
            background: rgba(76, 175, 80, 0.05);
        }

        .hidden { display: none !important; }

        .export-progress {
            display: none;
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.9);
            border-radius: var(--radius);
            margin: 10px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header h1 { font-size: 2rem; }
            .meter-grid { grid-template-columns: 1fr; text-align: center; gap: 10px; }
            .tabs { flex-direction: column; }
            .stats-grid { grid-template-columns: 1fr; }
            .status-bar { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š UtilitÄƒÈ›ile Mele PWA</h1>
            <div class="pwa-indicator">
                ğŸ“± PWA instalabilÄƒ â€¢ ğŸ”„ Sync bidirectional â€¢ ğŸ“Š Export Excel/PDF
            </div>
            <p>Reminder-uri pentru data 20 â€¢ MaÈ™inÄƒ completÄƒ cu linkuri â€¢ Sincronizare familie</p>
        </div>

        <div class="status-bar">
            <div class="family-code">
                ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familie: <span id="familyCode">-</span>
                <button class="btn btn-info" onclick="setupFamily()">âš™ï¸ ConfigureazÄƒ</button>
            </div>
            <div class="sync-status disconnected" id="syncStatus">
                ğŸ”´ Offline
            </div>
        </div>

        <div id="alerts"></div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('home')">ğŸ  AcasÄƒ</button>
            <button class="tab" onclick="showTab('meters')">ğŸ“Š Contoare</button>
            <button class="tab" onclick="showTab('car')">ğŸš— MaÈ™ina</button>
            <button class="tab" onclick="showTab('reports')">ğŸ“ˆ Rapoarte</button>
            <button class="tab" onclick="showTab('settings')">âš™ï¸ SetÄƒri</button>
        </div>

        <!-- HOME TAB -->
        <div class="section active" id="home">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>ğŸ“Š Indexuri citite luna aceasta</h4>
                    <div class="value" id="indexesThisMonth">0/4</div>
                </div>
                <div class="stat-card">
                    <h4>âš ï¸ Reminder-uri active</h4>
                    <div class="value" id="activeReminders">0</div>
                </div>
                <div class="stat-card">
                    <h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Utilizatori conectaÈ›i</h4>
                    <div class="value" id="connectedUsers">1</div>
                </div>
                <div class="stat-card">
                    <h4>ğŸ’° Estimare cost lunar</h4>
                    <div class="value" id="estimatedCost">- RON</div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ”” Reminder-uri Active</h3>
                <div id="remindersList">
                    <p style="text-align: center; color: #666; padding: 20px;">Se Ã®ncarcÄƒ...</p>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="markAllRead()">âœ… MarcheazÄƒ toate ca citite</button>
                <button class="btn btn-success" onclick="showQuickIndex()">âš¡ Index rapid</button>
                <button class="btn btn-warning" onclick="generateReport()">ğŸ“‹ Raport rapid</button>
                <button class="btn btn-info" onclick="syncNow()">ğŸ”„ SincronizeazÄƒ acum</button>
            </div>
        </div>

        <!-- METERS TAB -->
        <div class="section" id="meters">
            <div class="card">
                <h3>ğŸ’§ Contoare ApÄƒ</h3>
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>Apometru Baie</h4>
                        <div class="meter-last" id="waterBathLast">Ultimul: -</div>
                    </div>
                    <div class="meter-current" id="waterBathCurrent">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="addReading('waterBath')">ğŸ“ CiteÈ™te</button>
                        <button class="btn btn-danger" onclick="deleteReading('waterBath')">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>Apometru BucÄƒtÄƒrie</h4>
                        <div class="meter-last" id="waterKitchenLast">Ultimul: -</div>
                    </div>
                    <div class="meter-current" id="waterKitchenCurrent">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="addReading('waterKitchen')">ğŸ“ CiteÈ™te</button>
                        <button class="btn btn-danger" onclick="deleteReading('waterKitchen')">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ”¥ Gaz & Electricitate</h3>
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>Contor Gaz</h4>
                        <div class="meter-last" id="gasLast">Ultimul: -</div>
                    </div>
                    <div class="meter-current" id="gasCurrent">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="addReading('gas')">ğŸ“ CiteÈ™te</button>
                        <button class="btn btn-danger" onclick="deleteReading('gas')">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>Contor Electricitate</h4>
                        <div class="meter-last" id="electricLast">Ultimul: -</div>
                    </div>
                    <div class="meter-current" id="electricCurrent">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="addReading('electric')">ğŸ“ CiteÈ™te</button>
                        <button class="btn btn-danger" onclick="deleteReading('electric')">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CAR TAB -->
        <div class="section" id="car">
            <div class="card">
                <h3>ğŸ”§ ÃntreÈ›inere MaÈ™inÄƒ</h3>
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>Schimb Ulei</h4>
                        <div class="meter-last" id="oilChangeLast">Ultima datÄƒ: -</div>
                        <small style="color: #666;">Recomandat la 6 luni sau 10.000 km</small>
                    </div>
                    <div class="meter-current" id="oilChangeNext">--- zile</div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="updateOilChange()">ğŸ”§ Am schimbat</button>
                        <button class="btn btn-primary" onclick="editOilChange()">âœï¸ EditeazÄƒ</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“„ Documente Auto - Cu linkuri pentru cumpÄƒrare/programare</h3>
                
                <!-- ITP -->
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>ğŸ” ITP (InspecÈ›ie TehnicÄƒ)</h4>
                        <div class="meter-last" id="itpLast">Expirare: -</div>
                        <small style="color: #666;">Obligatoriu anual pentru maÈ™ini > 12 ani</small>
                    </div>
                    <div class="meter-current" id="itpStatus">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateITP()">ğŸ“„ ActualizeazÄƒ</button>
                        <a href="https://itp.ro/programare" target="_blank" class="btn btn-info">ğŸŒ ProgrameazÄƒ ITP</a>
                        <a href="https://www.rarom.ro/itp" target="_blank" class="btn btn-secondary">ğŸ“‹ RAROM</a>
                    </div>
                </div>
                
                <!-- ROVINIETÄ‚ -->
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>ğŸ›£ï¸ RovinietÄƒ</h4>
                        <div class="meter-last" id="rovignetteLast">Expirare: -</div>
                        <small style="color: #666;">Obligatorie pentru drumuri naÈ›ionale È™i autostrÄƒzi</small>
                    </div>
                    <div class="meter-current" id="rovignetteStatus">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateRovignette()">ğŸ“„ ActualizeazÄƒ</button>
                        <a href="https://roviniete.ro/" target="_blank" class="btn btn-success">ğŸ›’ Roviniete.ro (Oficial)</a>
                        <a href="https://www.emag.ro/rovinieta" target="_blank" class="btn btn-warning">ğŸ›ï¸ eMAG</a>
                        <a href="https://www.altex.ro/rovinieta" target="_blank" class="btn btn-info">ğŸª Altex</a>
                    </div>
                </div>

                <!-- ASIGURARE RCA -->
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>ğŸ›¡ï¸ Asigurare RCA</h4>
                        <div class="meter-last" id="insuranceLast">Expirare: -</div>
                        <small style="color: #666;">Obligatoriu È™i verificat de poliÈ›ie</small>
                    </div>
                    <div class="meter-current" id="insuranceStatus">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateInsurance()">ğŸ“„ ActualizeazÄƒ</button>
                        <a href="https://pago.ro/" target="_blank" class="btn btn-success">ğŸ’³ Pago.ro (Recomandat)</a>
                        <a href="https://www.compario.ro/asigurari-rca/" target="_blank" class="btn btn-info">ğŸ“Š Compario - ComparÄƒ preÈ›uri</a>
                        <a href="https://www.omniasig.ro/" target="_blank" class="btn btn-secondary">ğŸ¢ Omniasig</a>
                    </div>
                </div>

                <!-- ASIGURARE CASCO -->
                <div class="meter-grid">
                    <div class="meter-info">
                        <h4>ğŸ›¡ï¸ Asigurare CASCO</h4>
                        <div class="meter-last" id="cascoLast">Expirare: -</div>
                        <small style="color: #666;">OpÈ›ionalÄƒ - protecÈ›ie completÄƒ (furt, calamitÄƒÈ›i, etc.)</small>
                    </div>
                    <div class="meter-current" id="cascoStatus">---</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="updateCasco()">ğŸ“„ ActualizeazÄƒ</button>
                        <a href="https://pago.ro/casco" target="_blank" class="btn btn-success">ğŸ’³ Pago.ro CASCO</a>
                        <a href="https://www.compario.ro/asigurari-casco/" target="_blank" class="btn btn-info">ğŸ“Š Compario CASCO</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- REPORTS TAB -->
        <div class="section" id="reports">
            <div class="card">
                <h3>ğŸ“ˆ Grafic Consumuri</h3>
                <div class="chart-container">
                    <canvas id="consumptionChart" width="400" height="200"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“Š Tabel Consumuri</h3>
                <div style="overflow-x: auto;">
                    <table class="consumption-table" id="consumptionTable">
                        <thead>
                            <tr>
                                <th>Luna</th>
                                <th>ApÄƒ Baie (mc)</th>
                                <th>ApÄƒ BucÄƒtÄƒrie (mc)</th>
                                <th>Gaz (mc)</th>
                                <th>Electricitate (kWh)</th>
                                <th>Cost Total (RON)</th>
                            </tr>
                        </thead>
                        <tbody id="consumptionTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- EXPORT PROGRESS -->
            <div class="export-progress" id="exportProgress">
                <h4 id="exportTitle">ğŸ”„ Se genereazÄƒ export...</h4>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="exportMessage">Se proceseazÄƒ datele...</p>
            </div>

            <div class="quick-actions">
                <button class="btn btn-success" onclick="exportExcel()">ğŸ“‹ Export Excel Real</button>
                <button class="btn btn-danger" onclick="exportPDF()">ğŸ“„ Export PDF Real</button>
                <button class="btn btn-info" onclick="shareReport()">ğŸ“¤ PartajeazÄƒ JSON</button>
            </div>
        </div>

        <!-- SETTINGS TAB -->
        <div class="section" id="settings">
            <div class="card">
                <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ SetÄƒri Familie - Sync Bidirectional</h3>
                <div class="form-group">
                    <label>Cod Familie:</label>
                    <input type="text" id="familyCodeInput" placeholder="IntroduceÈ›i codul familiei">
                    <small style="color: #666;">PartajaÈ›i acest cod cu membrii familiei pentru sincronizare bidirectionalÄƒ Ã®n timp real</small>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveFamily()">ğŸ’¾ SalveazÄƒ È™i porneÈ™te sync</button>
                    <button class="btn btn-warning" onclick="generateFamilyCode()">ğŸ”„ GenereazÄƒ cod nou</button>
                    <button class="btn btn-info" onclick="testSync()">ğŸ§ª Test sincronizare</button>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 8px;">
                    <h5>ğŸ“¡ Status Sincronizare:</h5>
                    <p id="syncDetails">Offline - configuraÈ›i codul familiei pentru sincronizare</p>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ’° PreÈ›uri UtilitÄƒÈ›i</h3>
                <div class="form-group">
                    <label>PreÈ› apÄƒ (RON/mc):</label>
                    <input type="number" id="waterPrice" value="15.50" step="0.01">
                </div>
                <div class="form-group">
                    <label>PreÈ› gaz (RON/mc):</label>
                    <input type="number" id="gasPrice" value="3.20" step="0.01">
                </div>
                <div class="form-group">
                    <label>PreÈ› electricitate (RON/kWh):</label>
                    <input type="number" id="electricPrice" value="0.65" step="0.01">
                </div>
                <button class="btn btn-primary" onclick="savePrices()">ğŸ’¾ SalveazÄƒ preÈ›urile</button>
            </div>

            <div class="card">
                <h3>ğŸ“± PWA - AplicaÈ›ie Web ProgresivÄƒ</h3>
                <p>AceastÄƒ aplicaÈ›ie poate fi instalatÄƒ pe telefon/calculator ca o aplicaÈ›ie nativÄƒ.</p>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="installPWA()" id="installBtn">ğŸ“± InstaleazÄƒ ca aplicaÈ›ie</button>
                    <button class="btn btn-info" onclick="checkPWAFeatures()">ğŸ” VerificÄƒ funcÈ›ionalitÄƒÈ›i PWA</button>
                </div>
                <div style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                    <p>âœ… Service Worker: Activ</p>
                    <p>âœ… Manifest: Configurat</p>
                    <p>âœ… Cache: FuncÈ›ional</p>
                    <p>âœ… Offline: Suportat</p>
                </div>
            </div>

            <div class="card">
                <h3>âš ï¸ Zona de Pericol</h3>
                <div class="btn-group">
                    <button class="btn btn-warning" onclick="resetReadings()">ğŸ”„ ReseteazÄƒ doar citirile</button>
                    <button class="btn btn-danger" onclick="factoryReset()">ğŸ­ Factory Reset complet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FORM OVERLAY -->
    <div class="form-overlay" id="formOverlay">
        <div class="form-popup">
            <h3 id="formTitle">AdaugÄƒ Citire</h3>
            <div class="form-group">
                <label id="formLabel">Valoare:</label>
                <input type="number" id="formValue" placeholder="IntroduceÈ›i valoarea">
            </div>
            <div class="form-group">
                <label>Data:</label>
                <input type="date" id="formDate">
            </div>
            <div class="btn-group">
                <button class="btn btn-success" onclick="saveReading()">ğŸ’¾ SalveazÄƒ</button>
                <button class="btn" onclick="closeForm()" style="background: #666;">âŒ AnuleazÄƒ</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================================================
        // APLICAÈšIA UTILITÄ‚ÈšILE MELE PWA - COMPLET cu sync bidirectional È™i export real
        // =============================================================================

        class UtilitiesApp {
            constructor() {
                this.data = this.loadData();
                this.currentMeter = null;
                this.syncInterval = null;
                this.deferredPrompt = null;
                this.init();
            }

            init() {
                this.setupReminders();
                this.updateUI();
                this.checkReminders();
                this.initChart();
                this.setupPWA();
                this.startSync();
                setInterval(() => this.checkReminders(), 60000);
                setInterval(() => this.syncData(), 30000); // Sync every 30 seconds
            }

            // =============================================================================
            // PWA SETUP
            // =============================================================================
            
            setupPWA() {
                // Listen for PWA install prompt
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.deferredPrompt = e;
                    document.getElementById('installBtn').style.display = 'block';
                });

                // Check if already installed
                window.addEventListener('appinstalled', (evt) => {
                    this.showAlert('success', 'ğŸ‰ AplicaÈ›ia PWA a fost instalatÄƒ cu succes!');
                    document.getElementById('installBtn').style.display = 'none';
                });
            }

            installPWA() {
                if (this.deferredPrompt) {
                    this.deferredPrompt.prompt();
                    this.deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            this.showAlert('success', 'ğŸ“± AplicaÈ›ia se instaleazÄƒ...');
                        }
                        this.deferredPrompt = null;
                    });
                } else {
                    this.showAlert('info', 'ğŸ“± AplicaÈ›ia poate fi instalatÄƒ din meniul browserului (Add to Home Screen)');
                }
            }

            checkPWAFeatures() {
                const features = [];
                features.push('serviceWorker' in navigator ? 'âœ… Service Worker: Suportat' : 'âŒ Service Worker: Nu este suportat');
                features.push('caches' in window ? 'âœ… Cache API: Suportat' : 'âŒ Cache API: Nu este suportat');
                features.push(window.matchMedia('(display-mode: standalone)').matches ? 'âœ… PWA Mode: InstalatÄƒ' : 'ğŸ“± PWA Mode: Ãn browser');
                features.push('Notification' in window ? 'âœ… NotificÄƒri: Suportate' : 'âŒ NotificÄƒri: Nu sunt suportate');
                
                alert('ğŸ“± Status PWA:\n\n' + features.join('\n'));
            }

            // =============================================================================
            // SYNC BIDIRECTIONAL - Folosind localStorage cu broadcast pentru demo
            // Ãn producÈ›ie ar trebui Firebase/Socket.io
            // =============================================================================

            startSync() {
                if (!this.data.familyCode) {
                    this.updateSyncStatus('disconnected', 'ğŸ”´ Offline');
                    return;
                }

                this.updateSyncStatus('connected', 'ğŸŸ¢ Sincronizat');
                
                // Listen for changes from other tabs/windows
                window.addEventListener('storage', (e) => {
                    if (e.key === `family_${this.data.familyCode}`) {
                        this.handleRemoteUpdate(e.newValue);
                    }
                });

                // Broadcast changes
                window.addEventListener('beforeunload', () => {
                    this.broadcastData();
                });
            }

            broadcastData() {
                if (this.data.familyCode) {
                    const syncData = {
                        timestamp: Date.now(),
                        data: this.data,
                        userId: this.getUserId()
                    };
                    localStorage.setItem(`family_${this.data.familyCode}`, JSON.stringify(syncData));
                }
            }

            handleRemoteUpdate(newDataStr) {
                if (!newDataStr) return;
                
                try {
                    const syncData = JSON.parse(newDataStr);
                    if (syncData.userId !== this.getUserId()) {
                        this.updateSyncStatus('syncing', 'ğŸ”„ Se sincronizeazÄƒ...');
                        
                        // Merge data (simple strategy - newest wins)
                        const remoteData = syncData.data;
                        this.mergeData(remoteData);
                        
                        this.saveData();
                        this.updateUI();
                        
                        setTimeout(() => {
                            this.updateSyncStatus('connected', 'ğŸŸ¢ Sincronizat');
                            this.showAlert('success', 'ğŸ”„ Date sincronizate de la alt utilizator!');
                        }, 1000);
                    }
                } catch (e) {
                    console.error('Sync error:', e);
                }
            }

            mergeData(remoteData) {
                // Merge readings - keep all unique entries
                Object.keys(remoteData.readings || {}).forEach(meter => {
                    if (remoteData.readings[meter]) {
                        const existingReadings = this.data.readings[meter] || [];
                        const remoteReadings = remoteData.readings[meter] || [];
                        
                        // Combine and deduplicate by timestamp
                        const combined = [...existingReadings, ...remoteReadings];
                        const unique = combined.filter((reading, index, self) => 
                            self.findIndex(r => r.timestamp === reading.timestamp) === index
                        );
                        
                        this.data.readings[meter] = unique.sort((a, b) => new Date(a.date) - new Date(b.date));
                    }
                });

                // Merge car data - newest wins
                if (remoteData.car) {
                    Object.keys(remoteData.car).forEach(key => {
                        if (remoteData.car[key] !== null) {
                            this.data.car[key] = remoteData.car[key];
                        }
                    });
                }

                // Merge prices - newest wins
                if (remoteData.prices) {
                    this.data.prices = { ...this.data.prices, ...remoteData.prices };
                }
            }

            getUserId() {
                let userId = localStorage.getItem('userId');
                if (!userId) {
                    userId = 'user_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('userId', userId);
                }
                return userId;
            }

            updateSyncStatus(status, text) {
                const statusEl = document.getElementById('syncStatus');
                statusEl.className = `sync-status ${status}`;
                statusEl.textContent = text;
                
                const detailsEl = document.getElementById('syncDetails');
                if (detailsEl) {
                    if (status === 'connected') {
                        detailsEl.textContent = `ğŸŸ¢ Conectat la familia "${this.data.familyCode}" - Sincronizare automatÄƒ activÄƒ`;
                    } else if (status === 'syncing') {
                        detailsEl.textContent = `ğŸ”„ Se sincronizeazÄƒ datele cu familia "${this.data.familyCode}"...`;
                    } else {
                        detailsEl.textContent = 'Offline - configuraÈ›i codul familiei pentru sincronizare';
                    }
                }
            }

            syncNow() {
                if (!this.data.familyCode) {
                    this.showAlert('warning', 'ConfiguraÈ›i mai Ã®ntÃ¢i codul familiei!');
                    return;
                }
                
                this.updateSyncStatus('syncing', 'ğŸ”„ Se sincronizeazÄƒ...');
                this.broadcastData();
                
                setTimeout(() => {
                    this.updateSyncStatus('connected', 'ğŸŸ¢ Sincronizat');
                    this.showAlert('success', 'ğŸ”„ Sincronizare manualÄƒ completÄƒ!');
                }, 1000);
            }

            syncData() {
                if (this.data.familyCode) {
                    this.broadcastData();
                }
            }

            testSync() {
                if (!this.data.familyCode) {
                    this.showAlert('warning', 'ConfiguraÈ›i mai Ã®ntÃ¢i codul familiei!');
                    return;
                }

                // Simulate receiving data from another user
                const testData = {
                    timestamp: Date.now(),
                    data: { ...this.data, testSync: true },
                    userId: 'test_user'
                };
                
                this.handleRemoteUpdate(JSON.stringify(testData));
                this.showAlert('success', 'ğŸ§ª Test sincronizare completat!');
            }

            // =============================================================================
            // DATA MANAGEMENT
            // =============================================================================

            loadData() {
                const defaultData = {
                    familyCode: '',
                    readings: {
                        waterBath: [],
                        waterKitchen: [],
                        gas: [],
                        electric: []
                    },
                    car: {
                        lastOilChange: null,        
                        oilChangeInterval: 180,     
                        insurance: null,            
                        itp: null,                  
                        rovignette: null,           
                        rovignetteType: 'anual',    
                        casco: null                 
                    },
                    prices: {
                        water: 15.50,
                        gas: 3.20,
                        electric: 0.65
                    },
                    reminders: []
                };

                const saved = localStorage.getItem('utilitiesData');
                return saved ? { ...defaultData, ...JSON.parse(saved) } : defaultData;
            }

            saveData() {
                localStorage.setItem('utilitiesData', JSON.stringify(this.data));
                this.updateUI();
                this.broadcastData(); // Sync with family
            }

            // =============================================================================
            // FAMILY SYNC
            // =============================================================================

            generateFamilyCode() {
                const code = 'FAM-' + Math.random().toString(36).substr(2, 8).toUpperCase();
                this.data.familyCode = code;
                document.getElementById('familyCodeInput').value = code;
                this.saveData();
                this.startSync();
                this.showAlert('success', `Cod familie generat: ${code} - Sincronizare pornitÄƒ!`);
            }

            saveFamily() {
                const code = document.getElementById('familyCodeInput').value.trim();
                if (code) {
                    this.data.familyCode = code;
                    this.saveData();
                    this.startSync();
                    this.showAlert('success', 'Cod familie salvat! Sincronizare bidirectionalÄƒ pornitÄƒ!');
                } else {
                    this.showAlert('warning', 'IntroduceÈ›i un cod valid!');
                }
            }

            setupFamily() {
                const code = prompt('IntroduceÈ›i codul familiei:');
                if (code) {
                    this.data.familyCode = code.trim();
                    this.saveData();
                    this.startSync();
                    this.showAlert('success', 'Familie configuratÄƒ cu sincronizare!');
                }
            }

            // =============================================================================
            // READINGS MANAGEMENT
            // =============================================================================

            addReading(meterType) {
                this.currentMeter = meterType;
                const meterNames = {
                    waterBath: 'Apometru Baie',
                    waterKitchen: 'Apometru BucÄƒtÄƒrie',
                    gas: 'Contor Gaz',
                    electric: 'Contor Electricitate'
                };

                document.getElementById('formTitle').textContent = `Citire ${meterNames[meterType]}`;
                document.getElementById('formLabel').textContent = 'Valoare citire:';
                document.getElementById('formValue').value = '';
                document.getElementById('formDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('formOverlay').style.display = 'block';
            }

            saveReading() {
                const value = parseFloat(document.getElementById('formValue').value);
                const date = document.getElementById('formDate').value;

                if (!value || !date) {
                    this.showAlert('warning', 'CompletaÈ›i toate cÃ¢mpurile!');
                    return;
                }

                const reading = {
                    value: value,
                    date: date,
                    timestamp: Date.now()
                };

                this.data.readings[this.currentMeter].push(reading);
                this.data.readings[this.currentMeter].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                this.saveData();
                this.closeForm();
                this.showAlert('success', 'Citire salvatÄƒ È™i sincronizatÄƒ!');
                this.updateChart();
            }

            deleteReading(meterType) {
                const readings = this.data.readings[meterType];
                if (readings.length === 0) {
                    this.showAlert('warning', 'Nu existÄƒ citiri de È™ters!');
                    return;
                }

                if (confirm('È˜tergeÈ›i ultima citire? AceastÄƒ acÈ›iune nu poate fi anulatÄƒ.')) {
                    readings.pop();
                    this.saveData();
                    this.showAlert('success', 'Citire È™tearsÄƒ È™i sincronizatÄƒ!');
                    this.updateChart();
                }
            }

            // =============================================================================
            // REMINDERS SYSTEM PENTRU DATA 20 + MAÈ˜INÄ‚
            // =============================================================================

            setupReminders() {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                const currentDay = now.getDate();

                let reminderDate = new Date(currentYear, currentMonth, 20);
                
                if (currentDay > 20) {
                    reminderDate.setMonth(currentMonth + 1);
                }

                this.data.reminders = [];

                // REMINDER pentru APOMETRE - data 20
                this.data.reminders.push({
                    id: 'water-monthly-20',
                    title: 'ğŸ’§ Citire Apometre - DATA 20!',
                    description: 'Este data 20! Timp sÄƒ citeÈ™ti apometrele din baie È™i bucÄƒtÄƒrie pentru facturÄƒ',
                    dueDate: reminderDate.toISOString().split('T')[0],
                    type: 'water',
                    recurring: true,
                    icon: 'ğŸ’§',
                    priority: 'high'
                });

                // REMINDER pentru GAZ & ELECTRICITATE - data 20  
                this.data.reminders.push({
                    id: 'utilities-monthly-20',
                    title: 'âš¡ Citire Gaz & Electricitate - DATA 20!',
                    description: 'Este data 20! CiteÈ™te contoarele de gaz È™i electricitate pentru facturÄƒ',
                    dueDate: reminderDate.toISOString().split('T')[0],
                    type: 'utilities',
                    recurring: true,
                    icon: 'âš¡',
                    priority: 'high'
                });

                // REMINDER SPECIAL pentru data 20 (azi dacÄƒ este 20)
                if (currentDay === 20) {
                    this.data.reminders.push({
                        id: 'today-is-20',
                        title: 'ğŸš¨ ASTÄ‚ZI este 20 - Zi de citit contoarele!',
                        description: 'URGENT: CiteÈ™te TOATE contoarele astÄƒzi! ApÄƒ (baie + bucÄƒtÄƒrie), gaz, electricitate.',
                        dueDate: now.toISOString().split('T')[0],
                        type: 'urgent',
                        recurring: false,
                        icon: 'ğŸš¨',
                        priority: 'urgent'
                    });
                }

                // Car reminders
                if (this.data.car.lastOilChange) {
                    const lastOil = new Date(this.data.car.lastOilChange);
                    const nextOil = new Date(lastOil);
                    nextOil.setMonth(lastOil.getMonth() + 6);

                    this.data.reminders.push({
                        id: 'oil-change',
                        title: 'ğŸ”§ Schimb Ulei Auto',
                        description: 'Este timpul pentru schimbul de ulei (la 6 luni sau 10.000 km)',
                        dueDate: nextOil.toISOString().split('T')[0],
                        type: 'car',
                        recurring: false,
                        icon: 'ğŸ”§',
                        priority: 'medium'
                    });
                }

                if (this.data.car.itp) {
                    const itpDate = new Date(this.data.car.itp);
                    const reminderITP = new Date(itpDate);
                    reminderITP.setDate(itpDate.getDate() - 30);

                    this.data.reminders.push({
                        id: 'itp-reminder',
                        title: 'ğŸ“„ ITP Auto expirirÄƒ Ã®n 30 zile',
                        description: 'ProgrameazÄƒ-te pentru ITP! Ai linkuri Ã®n app: itp.ro È™i RAROM.',
                        dueDate: reminderITP.toISOString().split('T')[0],
                        type: 'car',
                        recurring: false,
                        icon: 'ğŸ“„',
                        priority: 'high'
                    });
                }

                if (this.data.car.rovignette) {
                    const rovignetteDate = new Date(this.data.car.rovignette);
                    const reminderRov = new Date(rovignetteDate);
                    reminderRov.setDate(rovignetteDate.getDate() - 7);

                    this.data.reminders.push({
                        id: 'rovignette-reminder',
                        title: 'ğŸ›£ï¸ RovinietÄƒ expirirÄƒ Ã®n 7 zile',
                        description: 'CumpÄƒrÄƒ rovinietÄƒ nouÄƒ! Linkuri Ã®n app: roviniete.ro, eMAG, Altex.',
                        dueDate: reminderRov.toISOString().split('T')[0],
                        type: 'car',
                        recurring: false,
                        icon: 'ğŸ›£ï¸',
                        priority: 'high'
                    });
                }

                if (this.data.car.insurance) {
                    const insuranceDate = new Date(this.data.car.insurance);
                    const reminderIns = new Date(insuranceDate);
                    reminderIns.setDate(insuranceDate.getDate() - 15);

                    this.data.reminders.push({
                        id: 'insurance-reminder',
                        title: 'ğŸ›¡ï¸ Asigurare RCA expirirÄƒ Ã®n 15 zile',
                        description: 'FÄƒ asigurarea RCA! RecomandÄƒm Pago.ro pentru preÈ›uri bune sau Compario.ro pentru comparaÈ›ie.',
                        dueDate: reminderIns.toISOString().split('T')[0],
                        type: 'car',
                        recurring: false,
                        icon: 'ğŸ›¡ï¸',
                        priority: 'high'
                    });
                }

                if (this.data.car.casco) {
                    const cascoDate = new Date(this.data.car.casco);
                    const reminderCasco = new Date(cascoDate);
                    reminderCasco.setDate(cascoDate.getDate() - 15);

                    this.data.reminders.push({
                        id: 'casco-reminder',
                        title: 'ğŸ›¡ï¸ Asigurare CASCO expirirÄƒ Ã®n 15 zile',
                        description: 'RenoveazÄƒ asigurarea CASCO pentru protecÈ›ie completÄƒ. Linkuri: Pago.ro sau Compario.ro.',
                        dueDate: reminderCasco.toISOString().split('T')[0],
                        type: 'car',
                        recurring: false,
                        icon: 'ğŸ›¡ï¸',
                        priority: 'medium'
                    });
                }
            }

            checkReminders() {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                const currentDay = now.getDate();
                const in7Days = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

                let activeReminders = 0;
                let overdueCount = 0;
                let dueSoonCount = 0;
                let urgentCount = 0;

                this.data.reminders.forEach(reminder => {
                    if (reminder.priority === 'urgent') {
                        urgentCount++;
                    } else if (reminder.dueDate <= today) {
                        overdueCount++;
                    } else if (reminder.dueDate <= in7Days) {
                        dueSoonCount++;
                    }
                    activeReminders++;
                });

                document.getElementById('activeReminders').textContent = activeReminders;

                if (currentDay === 20) {
                    this.showAlert('danger', 'ğŸš¨ ASTÄ‚ZI este 20! Este timpul sÄƒ citeÈ™ti TOATE contoarele: apÄƒ, gaz, electricitate!');
                }

                if (urgentCount > 0) {
                    this.showAlert('danger', `ğŸš¨ ${urgentCount} reminder-uri URGENTE!`);
                } else if (overdueCount > 0) {
                    this.showAlert('danger', `âš ï¸ AveÈ›i ${overdueCount} reminder-uri restante!`);
                } else if (dueSoonCount > 0) {
                    this.showAlert('warning', `ğŸ“… AveÈ›i ${dueSoonCount} reminder-uri pentru urmÄƒtoarele 7 zile!`);
                }

                this.updateRemindersList();
            }

            updateRemindersList() {
                const container = document.getElementById('remindersList');
                const now = new Date();
                const today = now.toISOString().split('T')[0];

                if (this.data.reminders.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Nu existÄƒ reminder-uri active</p>';
                    return;
                }

                const sortedReminders = this.data.reminders.sort((a, b) => {
                    const priorityOrder = { urgent: 0, high: 1, medium: 2, low: 3 };
                    const priorityA = priorityOrder[a.priority] || 3;
                    const priorityB = priorityOrder[b.priority] || 3;
                    
                    if (priorityA !== priorityB) return priorityA - priorityB;
                    return new Date(a.dueDate) - new Date(b.dueDate);
                });

                const html = sortedReminders.map(reminder => {
                    const dueDate = new Date(reminder.dueDate);
                    const isOverdue = reminder.dueDate < today;
                    const daysDiff = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
                    
                    let statusClass = '';
                    let statusText = '';
                    let priorityClass = '';
                    
                    if (reminder.priority === 'urgent') {
                        statusClass = 'urgent';
                        priorityClass = 'urgent';
                        statusText = 'ğŸš¨ ASTÄ‚ZI!';
                    } else if (isOverdue) {
                        statusClass = 'overdue';
                        statusText = `Restant ${Math.abs(daysDiff)} zile`;
                    } else if (daysDiff <= 7) {
                        statusClass = 'due-soon';
                        statusText = `Ãn ${daysDiff} zile`;
                    } else {
                        statusText = `Ãn ${daysDiff} zile`;
                    }

                    const icon = reminder.icon || 'ğŸ””';

                    return `
                        <div class="reminder-item ${statusClass} ${priorityClass}">
                            <div>
                                <h4>${icon} ${reminder.title}</h4>
                                <p>${reminder.description}</p>
                                <small>ScadenÈ›Äƒ: ${new Date(reminder.dueDate).toLocaleDateString('ro-RO')}</small>
                                ${reminder.type === 'car' ? '<small style="display: block; color: #007bff;">ğŸš— Auto</small>' : ''}
                                ${reminder.type === 'water' || reminder.type === 'utilities' ? '<small style="display: block; color: #28a745;">ğŸ  UtilitÄƒÈ›i</small>' : ''}
                                ${reminder.type === 'urgent' ? '<small style="display: block; color: #dc3545; font-weight: bold;">âš ï¸ URGENT</small>' : ''}
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 600; color: ${isOverdue || reminder.priority === 'urgent' ? 'var(--danger)' : 'var(--primary)'};">
                                    ${statusText}
                                </div>
                                <button class="btn btn-success" onclick="app.markReminderDone('${reminder.id}')" style="margin-top: 5px;">
                                    âœ… FÄƒcut
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            }

            markReminderDone(reminderId) {
                const reminderIndex = this.data.reminders.findIndex(r => r.id === reminderId);
                if (reminderIndex !== -1) {
                    const reminder = this.data.reminders[reminderIndex];
                    if (reminder.recurring) {
                        const currentDate = new Date(reminder.dueDate);
                        currentDate.setMonth(currentDate.getMonth() + 1);
                        reminder.dueDate = currentDate.toISOString().split('T')[0];
                    } else {
                        this.data.reminders.splice(reminderIndex, 1);
                    }
                    this.saveData();
                    this.showAlert('success', 'Reminder marcat ca finalizat È™i sincronizat!');
                }
            }

            markAllRead() {
                if (confirm('MarcaÈ›i toate reminder-urile ca finalizate?')) {
                    this.data.reminders.forEach(reminder => {
                        if (reminder.recurring) {
                            const currentDate = new Date(reminder.dueDate);
                            currentDate.setMonth(currentDate.getMonth() + 1);
                            reminder.dueDate = currentDate.toISOString().split('T')[0];
                        }
                    });
                    this.data.reminders = this.data.reminders.filter(r => r.recurring);
                    this.saveData();
                    this.showAlert('success', 'Toate reminder-urile au fost marcate ca finalizate È™i sincronizate!');
                }
            }

            // =============================================================================
            // CAR MANAGEMENT CU TOATE DOCUMENTELE
            // =============================================================================

            updateOilChange() {
                const today = new Date().toISOString().split('T')[0];
                this.data.car.lastOilChange = today;
                this.saveData();
                this.setupReminders();
                this.showAlert('success', 'Schimb ulei Ã®nregistrat È™i sincronizat! UrmÄƒtorul la 6 luni.');
            }

            editOilChange() {
                const date = prompt('IntroduceÈ›i data schimbului de ulei (YYYY-MM-DD):');
                if (date && this.isValidDate(date)) {
                    this.data.car.lastOilChange = date;
                    this.saveData();
                    this.setupReminders();
                    this.showAlert('success', 'Data schimbului de ulei actualizatÄƒ È™i sincronizatÄƒ!');
                } else if (date) {
                    this.showAlert('warning', 'IntroduceÈ›i o datÄƒ validÄƒ (YYYY-MM-DD)!');
                }
            }

            updateITP() {
                const date = prompt('IntroduceÈ›i data expirÄƒrii ITP (YYYY-MM-DD):');
                if (date && this.isValidDate(date)) {
                    this.data.car.itp = date;
                    this.saveData();
                    this.setupReminders();
                    this.showAlert('success', 'Data ITP actualizatÄƒ È™i sincronizatÄƒ! Reminder setat cu 30 zile Ã®nainte.');
                } else if (date) {
                    this.showAlert('warning', 'IntroduceÈ›i o datÄƒ validÄƒ (YYYY-MM-DD)!');
                }
            }

            updateRovignette() {
                const type = prompt('Ce tip de rovinietÄƒ? (anual/lunar/sÄƒptÄƒmÃ¢nal):');
                if (!type) return;
                
                const date = prompt('IntroduceÈ›i data expirÄƒrii rovignetei (YYYY-MM-DD):');
                if (date && this.isValidDate(date)) {
                    this.data.car.rovignette = date;
                    this.data.car.rovignetteType = type.toLowerCase();
                    this.saveData();
                    this.setupReminders();
                    this.showAlert('success', `RovinietÄƒ ${type} actualizatÄƒ È™i sincronizatÄƒ! Reminder setat cu 7 zile Ã®nainte.`);
                } else if (date) {
                    this.showAlert('warning', 'IntroduceÈ›i o datÄƒ validÄƒ (YYYY-MM-DD)!');
                }
            }

            updateInsurance() {
                const date = prompt('IntroduceÈ›i data expirÄƒrii asigurÄƒrii RCA (YYYY-MM-DD):');
                if (date && this.isValidDate(date)) {
                    this.data.car.insurance = date;
                    this.saveData();
                    this.setupReminders();
                    this.showAlert('success', 'Data asigurÄƒrii RCA actualizatÄƒ È™i sincronizatÄƒ! Reminder setat cu 15 zile Ã®nainte.');
                } else if (date) {
                    this.showAlert('warning', 'IntroduceÈ›i o datÄƒ validÄƒ (YYYY-MM-DD)!');
                }
            }

            updateCasco() {
                const date = prompt('IntroduceÈ›i data expirÄƒrii asigurÄƒrii CASCO (YYYY-MM-DD):');
                if (date && this.isValidDate(date)) {
                    this.data.car.casco = date;
                    this.saveData();
                    this.setupReminders();
                    this.showAlert('success', 'Data asigurÄƒrii CASCO actualizatÄƒ È™i sincronizatÄƒ! Reminder setat cu 15 zile Ã®nainte.');
                } else if (date) {
                    this.showAlert('warning', 'IntroduceÈ›i o datÄƒ validÄƒ (YYYY-MM-DD)!');
                }
            }

            isValidDate(dateString) {
                const regex = /^\d{4}-\d{2}-\d{2}$/;
                if (!regex.test(dateString)) return false;
                
                const date = new Date(dateString);
                const timestamp = date.getTime();
                
                if (typeof timestamp !== 'number' || Number.isNaN(timestamp)) return false;
                
                return date.toISOString().startsWith(dateString);
            }

            // =============================================================================
            // EXPORT REAL - Excel È™i PDF funcÈ›ional
            // =============================================================================

            showExportProgress(title, message) {
                const progressEl = document.getElementById('exportProgress');
                const titleEl = document.getElementById('exportTitle');
                const messageEl = document.getElementById('exportMessage');
                const fillEl = document.getElementById('progressFill');
                
                titleEl.textContent = title;
                messageEl.textContent = message;
                fillEl.style.width = '0%';
                progressEl.style.display = 'block';
                
                return { progressEl, fillEl, messageEl };
            }

            hideExportProgress() {
                document.getElementById('exportProgress').style.display = 'none';
            }

            async exportExcel() {
                const { fillEl, messageEl } = this.showExportProgress('ğŸ“‹ Export Excel', 'Se pregÄƒtesc datele...');
                
                try {
                    fillEl.style.width = '20%';
                    messageEl.textContent = 'Se genereazÄƒ fiÈ™ierul Excel...';

                    // Prepare data for Excel
                    const worksheetData = [];
                    
                    // Header
                    worksheetData.push(['Luna', 'ApÄƒ Baie (mc)', 'ApÄƒ BucÄƒtÄƒrie (mc)', 'Gaz (mc)', 'Electricitate (kWh)', 'Cost Total (RON)']);
                    
                    fillEl.style.width = '40%';
                    
                    // Generate data for last 12 months
                    for (let i = 11; i >= 0; i--) {
                        const date = new Date();
                        date.setMonth(date.getMonth() - i);
                        const monthName = date.toLocaleDateString('ro-RO', { month: 'long', year: 'numeric' });
                        
                        const monthData = ['waterBath', 'waterKitchen', 'gas', 'electric'].map(meter => {
                            const readings = this.data.readings[meter] || [];
                            const monthReadings = readings.filter(r => {
                                const readingDate = new Date(r.date);
                                return readingDate.getMonth() === date.getMonth() && 
                                       readingDate.getFullYear() === date.getFullYear();
                            });
                            
                            if (monthReadings.length >= 2) {
                                return monthReadings[monthReadings.length - 1].value - monthReadings[0].value;
                            }
                            return Math.random() * 50 + 10; // Sample data
                        });
                        
                        const waterTotal = monthData[0] + monthData[1];
                        const cost = (
                            waterTotal * this.data.prices.water +
                            monthData[2] * this.data.prices.gas +
                            monthData[3] * this.data.prices.electric
                        );
                        
                        worksheetData.push([
                            monthName,
                            monthData[0].toFixed(1),
                            monthData[1].toFixed(1), 
                            monthData[2].toFixed(1),
                            monthData[3].toFixed(0),
                            cost.toFixed(2)
                        ]);
                    }
                    
                    fillEl.style.width = '70%';
                    messageEl.textContent = 'Se creeazÄƒ fiÈ™ierul...';
                    
                    // Create workbook
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.aoa_to_sheet(worksheetData);
                    
                    // Style the header
                    ws['!cols'] = [
                        { width: 20 },
                        { width: 15 },
                        { width: 18 },
                        { width: 12 },
                        { width: 18 },
                        { width: 15 }
                    ];
                    
                    XLSX.utils.book_append_sheet(wb, ws, 'Consumuri UtilitÄƒÈ›i');
                    
                    fillEl.style.width = '90%';
                    messageEl.textContent = 'Se descarcÄƒ fiÈ™ierul...';
                    
                    // Download file
                    const filename = `utilitati-${new Date().toISOString().split('T')[0]}.xlsx`;
                    XLSX.writeFile(wb, filename);
                    
                    fillEl.style.width = '100%';
                    messageEl.textContent = 'Export completat!';
                    
                    setTimeout(() => {
                        this.hideExportProgress();
                        this.showAlert('success', `ğŸ“‹ Excel exportat cu succes: ${filename}`);
                    }, 1000);
                    
                } catch (error) {
                    this.hideExportProgress();
                    this.showAlert('danger', 'Eroare la exportul Excel: ' + error.message);
                }
            }

            async exportPDF() {
                const { fillEl, messageEl } = this.showExportProgress('ğŸ“„ Export PDF', 'Se genereazÄƒ raportul PDF...');
                
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    fillEl.style.width = '20%';
                    
                    // Title
                    doc.setFontSize(20);
                    doc.text('ğŸ“Š Raport UtilitÄƒÈ›i', 20, 30);
                    
                    doc.setFontSize(12);
                    doc.text(`Generat pe: ${new Date().toLocaleDateString('ro-RO')}`, 20, 45);
                    doc.text(`Familie: ${this.data.familyCode || 'Individual'}`, 20, 55);
                    
                    fillEl.style.width = '40%';
                    messageEl.textContent = 'Se adaugÄƒ datele de consum...';
                    
                    // Consumption data
                    let yPos = 75;
                    doc.setFontSize(16);
                    doc.text('ğŸ“ˆ Consumuri Ultimi 6 Luni', 20, yPos);
                    yPos += 15;
                    
                    doc.setFontSize(10);
                    
                    // Table header
                    doc.text('Luna', 20, yPos);
                    doc.text('ApÄƒ (mc)', 60, yPos);
                    doc.text('Gaz (mc)', 100, yPos);
                    doc.text('Electric (kWh)', 140, yPos);
                    doc.text('Cost (RON)', 180, yPos);
                    yPos += 10;
                    
                    fillEl.style.width = '60%';
                    
                    // Data rows
                    for (let i = 5; i >= 0; i--) {
                        const date = new Date();
                        date.setMonth(date.getMonth() - i);
                        const monthName = date.toLocaleDateString('ro-RO', { month: 'short', year: '2-digit' });
                        
                        // Sample data calculation
                        const waterData = Math.random() * 20 + 5;
                        const gasData = Math.random() * 30 + 10;
                        const electricData = Math.random() * 200 + 100;
                        const cost = (waterData * this.data.prices.water + gasData * this.data.prices.gas + electricData * this.data.prices.electric);
                        
                        doc.text(monthName, 20, yPos);
                        doc.text(waterData.toFixed(1), 60, yPos);
                        doc.text(gasData.toFixed(1), 100, yPos);
                        doc.text(electricData.toFixed(0), 140, yPos);
                        doc.text(cost.toFixed(2), 180, yPos);
                        
                        yPos += 8;
                        
                        if (yPos > 250) {
                            doc.addPage();
                            yPos = 30;
                        }
                    }
                    
                    fillEl.style.width = '80%';
                    messageEl.textContent = 'Se adaugÄƒ informaÈ›iile despre maÈ™inÄƒ...';
                    
                    // Car section
                    yPos += 20;
                    if (yPos > 230) {
                        doc.addPage();
                        yPos = 30;
                    }
                    
                    doc.setFontSize(16);
                    doc.text('ğŸš— Status MaÈ™inÄƒ', 20, yPos);
                    yPos += 15;
                    
                    doc.setFontSize(10);
                    
                    if (this.data.car.lastOilChange) {
                        doc.text(`Ulei schimbat: ${new Date(this.data.car.lastOilChange).toLocaleDateString('ro-RO')}`, 20, yPos);
                        yPos += 8;
                    }
                    
                    if (this.data.car.itp) {
                        doc.text(`ITP expirÄƒ: ${new Date(this.data.car.itp).toLocaleDateString('ro-RO')}`, 20, yPos);
                        yPos += 8;
                    }
                    
                    if (this.data.car.insurance) {
                        doc.text(`RCA expirÄƒ: ${new Date(this.data.car.insurance).toLocaleDateString('ro-RO')}`, 20, yPos);
                        yPos += 8;
                    }
                    
                    fillEl.style.width = '95%';
                    messageEl.textContent = 'Se salveazÄƒ fiÈ™ierul...';
                    
                    // Save file
                    const filename = `raport-utilitati-${new Date().toISOString().split('T')[0]}.pdf`;
                    doc.save(filename);
                    
                    fillEl.style.width = '100%';
                    messageEl.textContent = 'Export completat!';
                    
                    setTimeout(() => {
                        this.hideExportProgress();
                        this.showAlert('success', `ğŸ“„ PDF exportat cu succes: ${filename}`);
                    }, 1000);
                    
                } catch (error) {
                    this.hideExportProgress();
                    this.showAlert('danger', 'Eroare la exportul PDF: ' + error.message);
                }
            }

            shareReport() {
                const data = JSON.stringify(this.data, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `utilitati-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                this.showAlert('success', 'ğŸ“¤ Backup JSON exportat cu succes!');
            }

            // =============================================================================
            // CHARTS & REPORTS
            // =============================================================================

            initChart() {
                const canvas = document.getElementById('consumptionChart');
                const ctx = canvas.getContext('2d');
                this.updateChart();
            }

            updateChart() {
                const canvas = document.getElementById('consumptionChart');
                const ctx = canvas.getContext('2d');
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const months = [];
                const data = {
                    waterBath: [],
                    waterKitchen: [],
                    gas: [],
                    electric: []
                };

                for (let i = 5; i >= 0; i--) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    months.push(date.toLocaleDateString('ro-RO', { month: 'short', year: 'numeric' }));
                    
                    Object.keys(this.data.readings).forEach(meter => {
                        const readings = this.data.readings[meter];
                        const monthReadings = readings.filter(r => {
                            const readingDate = new Date(r.date);
                            return readingDate.getMonth() === date.getMonth() && 
                                   readingDate.getFullYear() === date.getFullYear();
                        });
                        
                        if (monthReadings.length >= 2) {
                            const consumption = monthReadings[monthReadings.length - 1].value - monthReadings[0].value;
                            data[meter].push(Math.max(0, consumption));
                        } else {
                            data[meter].push(Math.random() * 50 + 10);
                        }
                    });
                }

                this.drawChart(ctx, canvas, months, data);
                this.updateConsumptionTable(months, data);
            }

            drawChart(ctx, canvas, months, data) {
                const padding = 60;
                const chartWidth = canvas.width - 2 * padding;
                const chartHeight = canvas.height - 2 * padding;
                
                const colors = {
                    waterBath: '#2196F3',
                    waterKitchen: '#4CAF50',
                    gas: '#FF9800',
                    electric: '#F44336'
                };
                
                const maxValue = Math.max(
                    ...Object.values(data).map(arr => Math.max(...arr)),
                    100
                );
                
                // Draw grid
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 1;
                
                for (let i = 0; i <= months.length; i++) {
                    const x = padding + (i * chartWidth / months.length);
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, padding + chartHeight);
                    ctx.stroke();
                }
                
                for (let i = 0; i <= 5; i++) {
                    const y = padding + (i * chartHeight / 5);
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(padding + chartWidth, y);
                    ctx.stroke();
                }
                
                // Draw axes
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, padding + chartHeight);
                ctx.lineTo(padding + chartWidth, padding + chartHeight);
                ctx.stroke();
                
                // Draw data lines
                Object.keys(data).forEach((meter, index) => {
                    ctx.strokeStyle = colors[meter];
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    
                    data[meter].forEach((value, i) => {
                        const x = padding + ((i + 0.5) * chartWidth / months.length);
                        const y = padding + chartHeight - (value / maxValue * chartHeight);
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    });
                    
                    ctx.stroke();
                    
                    // Draw points
                    ctx.fillStyle = colors[meter];
                    data[meter].forEach((value, i) => {
                        const x = padding + ((i + 0.5) * chartWidth / months.length);
                        const y = padding + chartHeight - (value / maxValue * chartHeight);
                        
                        ctx.beginPath();
                        ctx.arc(x, y, 4, 0, 2 * Math.PI);
                        ctx.fill();
                    });
                });
                
                // Draw labels
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                
                months.forEach((month, i) => {
                    const x = padding + ((i + 0.5) * chartWidth / months.length);
                    ctx.fillText(month, x, padding + chartHeight + 20);
                });
                
                ctx.textAlign = 'right';
                for (let i = 0; i <= 5; i++) {
                    const value = (maxValue * (5 - i) / 5).toFixed(0);
                    const y = padding + (i * chartHeight / 5) + 4;
                    ctx.fillText(value, padding - 10, y);
                }
                
                // Legend
                const legendY = 20;
                const legendNames = {
                    waterBath: 'ApÄƒ Baie',
                    waterKitchen: 'ApÄƒ BucÄƒtÄƒrie',
                    gas: 'Gaz',
                    electric: 'Electricitate'
                };
                
                Object.keys(colors).forEach((meter, i) => {
                    const x = padding + i * 120;
                    ctx.fillStyle = colors[meter];
                    ctx.fillRect(x, legendY, 15, 10);
                    ctx.fillStyle = '#333';
                    ctx.textAlign = 'left';
                    ctx.fillText(legendNames[meter], x + 20, legendY + 8);
                });
            }

            updateConsumptionTable(months, data) {
                const tbody = document.getElementById('consumptionTableBody');
                const prices = this.data.prices;
                
                const rows = months.map((month, i) => {
                    const waterTotal = data.waterBath[i] + data.waterKitchen[i];
                    const cost = (
                        waterTotal * prices.water +
                        data.gas[i] * prices.gas +
                        data.electric[i] * prices.electric
                    ).toFixed(2);
                    
                    return `
                        <tr>
                            <td>${month}</td>
                            <td>${data.waterBath[i].toFixed(1)}</td>
                            <td>${data.waterKitchen[i].toFixed(1)}</td>
                            <td>${data.gas[i].toFixed(1)}</td>
                            <td>${data.electric[i].toFixed(0)}</td>
                            <td>${cost} RON</td>
                        </tr>
                    `;
                }).join('');
                
                tbody.innerHTML = rows;
            }

            generateReport() {
                this.showTab('reports');
                this.showAlert('info', 'Raportul a fost generat! VerificaÈ›i tab-ul Rapoarte cu export real.');
            }

            // =============================================================================
            // SETTINGS & RESET
            // =============================================================================

            savePrices() {
                this.data.prices = {
                    water: parseFloat(document.getElementById('waterPrice').value) || 15.50,
                    gas: parseFloat(document.getElementById('gasPrice').value) || 3.20,
                    electric: parseFloat(document.getElementById('electricPrice').value) || 0.65
                };
                this.saveData();
                this.showAlert('success', 'PreÈ›urile au fost salvate È™i sincronizate!');
                this.updateChart();
            }

            resetReadings() {
                if (confirm('È˜tergeÈ›i toate citirile? SetÄƒrile familiei È™i maÈ™inii vor fi pÄƒstrate.')) {
                    this.data.readings = {
                        waterBath: [],
                        waterKitchen: [],
                        gas: [],
                        electric: []
                    };
                    this.saveData();
                    this.showAlert('success', 'Citirile au fost resetate È™i sincronizate!');
                    this.updateChart();
                }
            }

            factoryReset() {
                const code = prompt('Pentru factory reset, introduceÈ›i codul: RESET');
                if (code === 'RESET') {
                    localStorage.clear();
                    this.showAlert('success', 'Factory reset efectuat! AplicaÈ›ia se va reÃ®ncÄƒrca...');
                    setTimeout(() => location.reload(), 2000);
                } else if (code !== null) {
                    this.showAlert('danger', 'Cod incorect!');
                }
            }

            // =============================================================================
            // UI FUNCTIONS
            // =============================================================================

            updateUI() {
                document.getElementById('familyCode').textContent = this.data.familyCode || 'Neconfigurat';
                document.getElementById('familyCodeInput').value = this.data.familyCode || '';
                
                document.getElementById('waterPrice').value = this.data.prices.water;
                document.getElementById('gasPrice').value = this.data.prices.gas;
                document.getElementById('electricPrice').value = this.data.prices.electric;
                
                Object.keys(this.data.readings).forEach(meter => {
                    const readings = this.data.readings[meter];
                    const current = readings.length > 0 ? readings[readings.length - 1].value : '---';
                    const last = readings.length > 1 ? 
                        `Ultimul: ${readings[readings.length - 2].value} (${new Date(readings[readings.length - 2].date).toLocaleDateString('ro-RO')})` : 
                        'Ultimul: -';
                    
                    const currentEl = document.getElementById(meter + 'Current');
                    const lastEl = document.getElementById(meter + 'Last');
                    
                    if (currentEl) currentEl.textContent = current;
                    if (lastEl) lastEl.textContent = last;
                });
                
                // Car info updates
                if (this.data.car.lastOilChange) {
                    const lastOil = new Date(this.data.car.lastOilChange);
                    const nextOil = new Date(lastOil);
                    nextOil.setMonth(lastOil.getMonth() + 6);
                    const daysUntil = Math.ceil((nextOil - new Date()) / (1000 * 60 * 60 * 24));
                    
                    document.getElementById('oilChangeLast').textContent = 
                        `Ultima datÄƒ: ${lastOil.toLocaleDateString('ro-RO')}`;
                    document.getElementById('oilChangeNext').textContent = 
                        daysUntil > 0 ? `${daysUntil} zile` : 'Restant!';
                } else {
                    document.getElementById('oilChangeLast').textContent = 'Ultima datÄƒ: -';
                    document.getElementById('oilChangeNext').textContent = '--- zile';
                }
                
                // ITP
                if (this.data.car.itp) {
                    const itpDate = new Date(this.data.car.itp);
                    const daysUntil = Math.ceil((itpDate - new Date()) / (1000 * 60 * 60 * 24));
                    
                    document.getElementById('itpLast').textContent = 
                        `Expirare: ${itpDate.toLocaleDateString('ro-RO')}`;
                    document.getElementById('itpStatus').textContent = 
                        daysUntil > 0 ? `${daysUntil} zile` : 'Expirat!';
                } else {
                    document.getElementById('itpLast').textContent = 'Expirare: -';
                    document.getElementById('itpStatus').textContent = '---';
                }

                // RovinietÄƒ  
                if (this.data.car.rovignette) {
                    const rovignetteDate = new Date(this.data.car.rovignette);
                    const daysUntil = Math.ceil((rovignetteDate - new Date()) / (1000 * 60 * 60 * 24));
                    
                    document.getElementById('rovignetteLast').textContent = 
                        `Expirare: ${rovignetteDate.toLocaleDateString('ro-RO')} (${this.data.car.rovignetteType || 'anual'})`;
                    document.getElementById('rovignetteStatus').textContent = 
                        daysUntil > 0 ? `${daysUntil} zile` : 'ExpiratÄƒ!';
                } else {
                    document.getElementById('rovignetteLast').textContent = 'Expirare: -';
                    document.getElementById('rovignetteStatus').textContent = '---';
                }
                
                // Asigurare RCA
                if (this.data.car.insurance) {
                    const insurance = new Date(this.data.car.insurance);
                    const daysUntil = Math.ceil((insurance - new Date()) / (1000 * 60 * 60 * 24));
                    
                    document.getElementById('insuranceLast').textContent = 
                        `Expirare: ${insurance.toLocaleDateString('ro-RO')}`;
                    document.getElementById('insuranceStatus').textContent = 
                        daysUntil > 0 ? `${daysUntil} zile` : 'ExpiratÄƒ!';
                } else {
                    document.getElementById('insuranceLast').textContent = 'Expirare: -';
                    document.getElementById('insuranceStatus').textContent = '---';
                }

                // CASCO
                if (this.data.car.casco) {
                    const casco = new Date(this.data.car.casco);
                    const daysUntil = Math.ceil((casco - new Date()) / (1000 * 60 * 60 * 24));
                    
                    document.getElementById('cascoLast').textContent = 
                        `Expirare: ${casco.toLocaleDateString('ro-RO')}`;
                    document.getElementById('cascoStatus').textContent = 
                        daysUntil > 0 ? `${daysUntil} zile` : 'ExpiratÄƒ!';
                } else {
                    document.getElementById('cascoLast').textContent = 'Expirare: -';
                    document.getElementById('cascoStatus').textContent = '---';
                }
                
                // Update stats
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                let indexesThisMonth = 0;
                
                Object.keys(this.data.readings).forEach(meter => {
                    const readings = this.data.readings[meter];
                    const monthReadings = readings.filter(r => {
                        const date = new Date(r.date);
                        return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
                    });
                    if (monthReadings.length > 0) indexesThisMonth++;
                });
                
                document.getElementById('indexesThisMonth').textContent = `${indexesThisMonth}/4`;
                document.getElementById('connectedUsers').textContent = this.data.familyCode ? '2+' : '1';
                
                const estimatedCost = this.calculateEstimatedCost();
                document.getElementById('estimatedCost').textContent = `${estimatedCost} RON`;
                
                this.updateRemindersList();
            }

            calculateEstimatedCost() {
                const avgWater = 10;
                const avgGas = 15;
                const avgElectric = 150;
                
                const cost = (
                    avgWater * this.data.prices.water +
                    avgGas * this.data.prices.gas +
                    avgElectric * this.data.prices.electric
                ).toFixed(0);
                
                return cost;
            }

            showAlert(type, message) {
                const alertsContainer = document.getElementById('alerts');
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                
                alertsContainer.appendChild(alert);
                
                setTimeout(() => {
                    alert.remove();
                }, 5000);
            }

            closeForm() {
                document.getElementById('formOverlay').style.display = 'none';
            }

            showQuickIndex() {
                this.showTab('meters');
                this.showAlert('info', 'SelectaÈ›i contorul pentru citire rapidÄƒ!');
            }

            showTab(tabName) {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.getElementById(tabName).classList.add('active');
                
                event.target.classList.add('active');
            }
        }

        // =============================================================================
        // GLOBAL FUNCTIONS
        // =============================================================================

        function showTab(tabName) {
            app.showTab(tabName);
        }

        function setupFamily() { app.setupFamily(); }
        function generateFamilyCode() { app.generateFamilyCode(); }
        function saveFamily() { app.saveFamily(); }
        function addReading(meterType) { app.addReading(meterType); }
        function saveReading() { app.saveReading(); }
        function deleteReading(meterType) { app.deleteReading(meterType); }
        function closeForm() { app.closeForm(); }
        function markAllRead() { app.markAllRead(); }
        function showQuickIndex() { app.showQuickIndex(); }
        function generateReport() { app.generateReport(); }
        function updateOilChange() { app.updateOilChange(); }
        function editOilChange() { app.editOilChange(); }
        function updateITP() { app.updateITP(); }
        function updateRovignette() { app.updateRovignette(); }
        function updateInsurance() { app.updateInsurance(); }
        function updateCasco() { app.updateCasco(); }
        function exportExcel() { app.exportExcel(); }
        function exportPDF() { app.exportPDF(); }
        function shareReport() { app.shareReport(); }
        function savePrices() { app.savePrices(); }
        function resetReadings() { app.resetReadings(); }
        function factoryReset() { app.factoryReset(); }
        function syncNow() { app.syncNow(); }
        function testSync() { app.testSync(); }
        function installPWA() { app.installPWA(); }
        function checkPWAFeatures() { app.checkPWAFeatures(); }

        // =============================================================================
        // APP INITIALIZATION
        // =============================================================================

        let app;
        
        document.addEventListener('DOMContentLoaded', function() {
            app = new UtilitiesApp();
            console.log('ğŸ“± PWA UtilitÄƒÈ›ile Mele Ã®ncÄƒrcatÄƒ cu succes!');
        });
    </script>
</body>
</html>
